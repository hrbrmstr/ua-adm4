library(sf)
library(tidyverse)

# https://data.humdata.org/
# https://s3.us-east-1.amazonaws.com/hdx-production-filestore/resources/4105bb4d-5a9d-4824-a1d7-53141cf47c44/ukr_adm_sspe_20220131.zip?AWSAccessKeyId=AKIAXYC32WNARK756OUG&Expires=1651311128&Signature=LWQRhNGOu7BIIumbZAUuDNZ2W0s%3Dua <- st_read("~/Desktop/ukr_adm_sspe_20220131/ukr_admbnda_adm4_sspe_20220114.shp")

ua <- st_read("~/Data/ukr_adm_sspe_20220131/ukr_admbnda_adm4_sspe_20220114.shp")

# https://data.humdata.org/
# https://s3.us-east-1.amazonaws.com/hdx-production-filestore/resources/d807fdc4-1731-4091-912c-6323a8438aa2/2021-06-22_populated-places_hdx.xlsb?AWSAccessKeyId=AKIAXYC32WNARK756OUG&Expires=1651310644&Signature=7B9nWxpEHAZ0wzgcoNd6bc2KITw%3D

ua_pop <- read_csv("~/Data/2021-06-22_populated-places_hdx.csv")

ua |> 
  left_join(
    ua_pop |> 
      select(
        ADM4_PCODE = admin4Pcode, 
        zone = Zone,
        population = Population
      )
  ) -> ua_adm4_pop

ua |> 
  select(ADM4_PCODE) |> 
  st_make_valid() |> 
  st_centroid() |> 
  st_write("~/Data/ua-adm4-pop-centroids.geojson")

glimpse(ua_adm4_pop)
## Rows: 29,714
## Columns: 35
## $ Shape_Leng <dbl> 0.83165899, 0.04712084, 0.07193155, 0.01401488, 0.04772020, 0.…
## $ Shape_Area <dbl> 1.016721e-02, 9.104979e-05, 1.173136e-04, 1.131248e-05, 8.3336…
## $ ADM4_EN    <chr> "Simferopol", "Aeroflotskyi", "Hresivskyi", "Bitumne", "Komsom…
## $ ADM4_UA    <chr> "Сімферополь", "Аерофлотський", "Гресівський", "Бітумне", "Ком…
## $ ADM4_RU    <chr> "Симферополь", "Аэрофлотский", "Грэсовский", "Битумное", "Комс…
## $ ADM4_PCODE <chr> "UA0116033001", "UA0116003002", "UA0116003001", "UA0116003004"…
## $ ADM4_REF   <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ ADM4ALT1EN <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ ADM4ALT2EN <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ ADM4ALT1UA <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ ADM4ALT2UA <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ ADM4ALT1RU <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ ADM4ALT2RU <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ ADM3_EN    <chr> "Simferopolska", "Hresivska", "Hresivska", "Hresivska", "Hresi…
## $ ADM3_UA    <chr> "Сімферопольська", "Гресівська", "Гресівська", "Гресівська", "…
## $ ADM3_RU    <chr> "Симферопольский", "Грэсовский", "Грэсовский", "Грэсовский", "…
## $ ADM3_PCODE <chr> "UA0116033", "UA0116003", "UA0116003", "UA0116003", "UA0116003…
## $ ADM2_EN    <chr> "Simferopolskyi", "Simferopolskyi", "Simferopolskyi", "Simfero…
## $ ADM2_UA    <chr> "Сімферопольський", "Сімферопольський", "Сімферопольський", "С…
## $ ADM2_RU    <chr> "Симферопольский", "Симферопольский", "Симферопольский", "Симф…
## $ ADM2_PCODE <chr> "UA0116", "UA0116", "UA0116", "UA0116", "UA0116", "UA0116", "U…
## $ ADM1_EN    <chr> "Avtonomna Respublika Krym", "Avtonomna Respublika Krym", "Avt…
## $ ADM1_UA    <chr> "Автономна Республіка Крим", "Автономна Республіка Крим", "Авт…
## $ ADM1_RU    <chr> "Автономная Республика Крым", "Автономная Республика Крым", "А…
## $ ADM1_PCODE <chr> "UA01", "UA01", "UA01", "UA01", "UA01", "UA01", "UA01", "UA01"…
## $ ADM0_EN    <chr> "Ukraine", "Ukraine", "Ukraine", "Ukraine", "Ukraine", "Ukrain…
## $ ADM0_UA    <chr> "Україна", "Україна", "Україна", "Україна", "Україна", "Україн…
## $ ADM0_RU    <chr> "Украина", "Украина", "Украина", "Украина", "Украина", "Украин…
## $ ADM0_PCODE <chr> "UA", "UA", "UA", "UA", "UA", "UA", "UA", "UA", "UA", "UA", "U…
## $ date       <date> 2021-11-09, 2021-11-09, 2021-11-09, 2021-11-09, 2021-11-09, 2…
## $ validOn    <date> 2022-01-14, 2022-01-14, 2022-01-14, 2022-01-14, 2022-01-14, 2…
## $ validTo    <date> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ zone       <chr> "GCA 20+", "GCA 20+", "GCA 20+", "GCA 20+", "GCA 20+", "GCA 20…
## $ population <dbl> 337285, 2325, 18806, 221, 4869, 6034, 28418, 6089, 2290, 1045,…
## $ geometry   <MULTIPOLYGON [°]> MULTIPOLYGON (((34.17316 44..., MULTIPOLYGON (((3…

st_write(ua_adm4_pop, "~/Data/ua-adm4-with-population.geojson")

